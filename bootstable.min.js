"use strict";var params=null,colsEdi=null,newColHtml='<div class="btn-group float-end"><button id="bEdit" type="button" class="btn btn-sm btn-primary" onclick="butRowEdit(this);"><span class="fa fa-pencil" > </span></button><button id="bElim" type="button" class="btn btn-sm btn-danger" onclick="butRowDelete(this);"><span class="fa fa-trash" > </span></button><button id="bAcep" type="button" class="btn btn-sm btn-success" style="display:none;" onclick="butRowAcep(this);"><span class="fa fa-check" > </span></button><button id="bCanc" type="button" class="btn btn-sm btn-warning" style="display:none;" onclick="butRowCancel(this);"><span class="fa fa-remove" > </span></button></div>',newColHtml2='<div class="btn-group float-end"><button id="bEdit" type="button" class="btn btn-sm btn-primary" onclick="butRowEdit(this);"><span class="fa fa-pencil" > ✎ </span></button><button id="bElim" type="button" class="btn btn-sm btn-danger" onclick="butRowDelete(this);"><span class="fa fa-trash" > X </span></button><button id="bAcep" type="button" class="btn btn-sm btn-success" style="display:none;" onclick="butRowAcep(this);"><span class="fa fa-check" > ✓ </span></button><button id="bCanc" type="button" class="btn btn-sm btn-warning" style="display:none;" onclick="butRowCancel(this);"><span class="fa fa-remove" > → </span></button></div>',colEdicHtml=document.createElement("td");function SetEditable(t,e){params=_extend({columnsEd:null,$addButton:null,bootstrap:!0,defaultValues:[],addButtonEdit:!0,onEdit:function(){},onBeforeDelete:function(){},onDelete:function(){},onAdd:function(){}},e);const n=document.createElement("th");if(n.setAttribute("name","buttons"),params.$addButton){const l=document.createElement("button");l.className="btn btn-success float-end",l.id=params.$addButton,l.addEventListener("click",()=>{params.addButtonEdit?rowAddNewAndEdit(t,params.defaultValues):rowAddNew(t)});const d=document.createElement("i");d.className="fa fa-plus",l.appendChild(d),n.appendChild(l)}document.querySelectorAll(`#${t} thead tr`)[0].appendChild(n),params.bootstrap||(colEdicHtml.innerHTML=`<td name="buttons">${newColHtml2}</td>`);const o=document.querySelectorAll(`#${t} tbody tr`);for(var a=0;a<o.length;a++)console.log(o[a]),o[a].appendChild(colEdicHtml.cloneNode(!0));null!=params.columnsEd&&(colsEdi=params.columnsEd.split(","))}function IterarCamposEdit(t,e){var n=0;for(const o of t){if(n++,"none"==o.style.display)return;if("buttons"==o.getAttribute("name"))return;if(!IsEditable(n-1))return;e(o)}}function IsEditable(t){return null==colsEdi||!!colsEdi.includes(t)}function ModoEdicion(t){return"editing"==t.id}function SetButtonsNormal(t){var e;for(e of t.parentNode.childNodes)switch(e.id){case"bAcep":case"bCanc":e.style.display="none";break;case"bEdit":case"bElim":e.style.display="block"}t.parentNode.parentNode.parentNode.setAttribute("id","")}function SetButtonsEdit(t){var e;for(e of t.parentNode.childNodes)switch(e.id){case"bAcep":case"bCanc":e.style.display="block";break;case"bEdit":case"bElim":e.style.display="none"}t.parentNode.parentNode.parentNode.setAttribute("id","editing")}function butRowAcep(t){var e=t.parentNode.parentNode.parentNode,n=e.querySelectorAll("td");ModoEdicion(e)&&(IterarCamposEdit(n,function(t){var e=t.querySelector("input").value;t.innerHTML=e}),SetButtonsNormal(t),params.onEdit(e))}function butRowCancel(t){var e=t.parentNode.parentNode.parentNode,n=e.querySelectorAll("td");ModoEdicion(e)&&(IterarCamposEdit(n,function(t){var e=t.querySelector("div").innerHTML;t.innerHTML=e}),SetButtonsNormal(t))}function butRowEdit(t){var n,e=t.parentNode.parentNode.parentNode,o=e.querySelectorAll("td");ModoEdicion(e)||(n=!1,IterarCamposEdit(o,function(t){var e=t.innerHTML;t.innerHTML='<div style="display: none;">'+e+"</div>"+('<input class="form-control input-sm"  value="'+e+'">'),n||(t.querySelectorAll("input")[0].focus(),n=!0)}),SetButtonsEdit(t))}function butRowDelete(t){t=t.parentNode.parentNode.parentNode;params.onBeforeDelete(t),t.remove(),params.onDelete()}function rowAddNew(t,e=[]){var n,o=document.getElementById(t),t=o.querySelectorAll("thead tr")[0].querySelectorAll("th"),a=0,l=document.createElement("tr");for(const d of t){if("buttons"==d.getAttribute("name"))l.appendChild(colEdicHtml);else{const s=document.createElement("td");a<e.length&&(n=document.createTextNode(e[a]),s.appendChild(n)),l.appendChild(s)}a++}o.querySelectorAll("tbody")[0].appendChild(l),params.onAdd()}function rowAddNewAndEdit(t,e=[]){rowAddNew(t,e),butRowEdit(document.getElementById(t).querySelectorAll("tbody")[0].lastChild.querySelector("#bEdit"))}function TableToCSV(t,e){var n,o="",t=document.getElementById(t);for(const a of t.querySelectorAll("tbody tr"))ModoEdicion(a)&&(n=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}),a.getElementByID("bAcep").dispatchEvent(n));o="";for(const l of t.querySelectorAll("td"))"buttons"!=l.getAttribute("name")&&(o=o+l.innerHTML+e);return(o=""!=o?o.substr(0,o.length-e.length):o)+"\n"}function TableToJson(t){var e=[];const n=document.getElementById(t);var o=[];for(const l of n.querySelectorAll("thead tr th"))o.push(l.innerHTML);for(const d of n.querySelectorAll("tbody tr")){var a=0;e.push({});for(const s of d.querySelectorAll("td"))e[e.length-1][o[a]]=s.innerHTML,a++}return JSON.Stringify(e)}function _extend(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}colEdicHtml.setAttribute("name","buttons"),colEdicHtml.innerHTML=newColHtml;