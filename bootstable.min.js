"use strict";class bootstable{constructor(t,e){this.table=document.getElementById(t),this.headers=this._getTableHeaders(this.table),this.params=this._extend({columnsEd:[],$addButton:null,exportCsvButton:!1,exportJsonButton:!1,defaultValues:[],addButtonEdit:!0,buttons:null,onEditSave:function(){},onBeforeDelete:function(){},onDelete:function(){},onAdd:function(){}},e),this.colEdicHtml=document.createElement("td"),this.colEdicHtml.setAttribute("name","buttons"),this.colEdicHtml.appendChild(this._buildDefaultButtons(this.params.buttons)),this.SetEditable(t)}SetEditable(t){const e=document.createElement("th");if(e.setAttribute("name","buttons"),this.params.exportCsvButton){const s=document.createElement("button");s.className="btn btn-secondary float-end",s.id="btnCsv",s.addEventListener("click",()=>{this.TableToCSV(t,",",!0,t+".export.csv")}),s.setAttribute("text","Export to CSV");const l=document.createElement("i");l.className="bi bi-file-spreadsheet",s.appendChild(l),e.appendChild(s)}if(this.params.exportCsvButton){const d=document.createElement("button");d.className="btn btn-secondary float-end",d.id="btnJson",d.addEventListener("click",()=>{this.TableToJSON(t,!0,t+".export.csv")}),d.setAttribute("text","Export to JSON");const i=document.createElement("i");i.className="bi bi-file-code",d.appendChild(i),e.appendChild(d)}if(this.params.$addButton){const r=document.createElement("button");r.className="btn btn-success float-end",r.id=this.params.$addButton,r.addEventListener("click",()=>{this.params.addButtonEdit?this.rowAddNewAndEdit(t,this.params.defaultValues):this.rowAddNew(t)}),r.setAttribute("text","Add New Row");const c=document.createElement("i");c.className="bi bi-plus",r.appendChild(c),e.appendChild(r)}document.querySelectorAll(`#${t} thead tr`)[0].appendChild(e);const n=document.querySelectorAll(`#${t} tbody tr`);for(var o=0;o<n.length;o++){var a=document.createElement("td");a.setAttribute("name","buttons"),a.appendChild(this._buildDefaultButtons(this.params.buttons)),n[o].appendChild(a)}null!=this.params.columnsEd&&(this.colsEdi=this.params.columnsEd)}IterarCamposEdit(t,e){var n=-1;for(const o of t)console.log(o,n),n++,"none"!=o.style.display&&"buttons"!=o.getAttribute("name")&&this.IsEditable(n)&&e(this,o,n)}IsEditable(t){return console.log(this.colsEdi,t),0==this.colsEdi.length||this.colsEdi.includes(t)}ModoEdicion(t){return"editing"==t.id}SetButtonsNormal(t){var e;for(e of t.parentNode.childNodes)switch(e.id){case"bAcep":case"bCanc":e.style.display="none";break;case"bEdit":case"bElim":e.style.display="block"}t.parentNode.parentNode.parentNode.setAttribute("id","")}SetButtonsEdit(t){var e;for(e of t.parentNode.childNodes)switch(e.id){case"bAcep":case"bCanc":e.style.display="block";break;case"bEdit":case"bElim":e.style.display="none"}t.parentNode.parentNode.parentNode.setAttribute("id","editing")}butRowAcep(t){var e=t.parentNode.parentNode.parentNode,n=e.querySelectorAll("td");console.log(n.length),this.ModoEdicion(e)&&(this.IterarCamposEdit(n,function(t,e,n){var o=e.querySelector("input").value;e.innerHTML=o}),this.SetButtonsNormal(t),this.params.onEditSave(e))}butRowCancel(t){var e=t.parentNode.parentNode.parentNode,n=e.querySelectorAll("td");console.log(n.length),this.ModoEdicion(e)&&(this.IterarCamposEdit(n,function(t,e,n){var o=e.querySelector("div").innerHTML;e.innerHTML=o}),this.SetButtonsNormal(t))}butRowEdit(t){console.log(t);var e=t.parentNode.parentNode.parentNode;console.log(e);var l,n=e.querySelectorAll("td");console.log(n),this.ModoEdicion(e)||(l=!1,this.IterarCamposEdit(n,function(t,e,n){var o=e.innerHTML;e.innerHTML="";var a=document.createElement("div");a.style.display="none";var s=document.createTextNode(o);a.appendChild(s),e.appendChild(a);a=document.createElement("input");a.className="form-control form-control-sm",a.value=o,a.setAttribute("name",t.headers[n]),e.appendChild(a),l||(e.querySelectorAll("input")[0].focus(),l=!0)}),this.SetButtonsEdit(t))}butRowDelete(t){t=t.parentNode.parentNode.parentNode;this.params.onBeforeDelete(t),t.remove(),this.params.onDelete()}rowAddNew(t,e=[]){var n,o=document.getElementById(t),t=o.querySelectorAll("thead tr")[0].querySelectorAll("th"),a=0,s=document.createElement("tr");for(const l of t)if("none"!=l.style.display){if("buttons"==l.getAttribute("name"))s.appendChild(this.colEdicHtml);else{const d=document.createElement("td");a<e.length&&(n=document.createTextNode(e[a]),d.appendChild(n)),s.appendChild(d)}a++}o.querySelectorAll("tbody")[0].appendChild(s),this.params.onAdd()}rowAddNewAndEdit(t,e=[]){this.rowAddNew(t,e);t=document.getElementById(t).querySelectorAll("tbody")[0].lastChild;this.butRowEdit(t.querySelector("#bEdit"))}TableToCSV(t,e,n=!1,o=null){var a=[],s=document.getElementById(t),t=this._getTableHeaders(s);a.push(t);for(const i of s.querySelectorAll("tbody tr")){var l=i.querySelectorAll("td");a.push([]);for(const r of l)"buttons"!=r.getAttribute("name")&&a[a.length-1].push(r.innerHTML)}var d="";for(const c of a)d+=c.join(e)+"\n";return n&&o&&this._download(o,d,"application/csv"),d}TableToJson(t,e=!1,n=null){var o=[];const a=document.getElementById(t);var s=[];for(const d of a.querySelectorAll("thead tr th"))s.push(d.innerHTML);for(const i of a.querySelectorAll("tbody tr")){var l=0;o.push({});for(const r of i.querySelectorAll("td"))"buttons"!=r.getAttribute("name")&&(o[o.length-1][s[l]]=r.innerHTML,l++)}return e&&this._download(n,JSON.stringify(o),"application/json"),JSON.stringify(o)}_extend(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}_buildDefaultButtons(t={}){var e={bEdit:{className:"btn btn-sm btn-primary",icon:"bi bi-pencil",display:"block",onclick:t=>{var e=t.target;"I"==e.tagName&&(e=t.target.parentNode),this.butRowEdit(e)}},bElim:{className:"btn btn-sm btn-danger",icon:"bi bi-trash",display:"block",onclick:t=>{var e=t.target;"I"==e.tagName&&(e=t.target.parentNode),this.butRowDelete(e)}},bAcep:{className:"btn btn-sm btn-success",icon:"bi bi-check",display:"none",onclick:t=>{var e=t.target;"I"==e.tagName&&(e=t.target.parentNode),this.butRowAcep(e)}},bCanc:{className:"btn btn-sm btn-warning",icon:"bi bi-x-circle",display:"none",onclick:t=>{var e=t.target;"I"==e.tagName&&(e=t.target.parentNode),this.butRowCancel(e)}}};this.localbuttons=this._extend(e,t);const n=document.createElement("div");n.className="d-grid gap-2 d-md-flex justify-content-md-end";for(const o in this.localbuttons){const a=document.createElement("button");a.id=o,a.className=this.localbuttons[o].className,a.style.display=this.localbuttons[o].display,a.addEventListener("click",this.localbuttons[o].onclick);const s=document.createElement("i");s.className=this.localbuttons[o].icon,a.appendChild(s),n.appendChild(a)}return n}_download(t,e,n="text/plain"){var o=document.createElement("a");o.setAttribute("href",`data:${n};charset=utf-8,`+encodeURIComponent(e)),o.setAttribute("download",t),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}_getTableHeaders(t){var e=[];for(const n of t.querySelectorAll("thead tr th"))"buttons"!=n.getAttribute("name")&&e.push(n.innerHTML);return e}}