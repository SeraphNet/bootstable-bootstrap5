"use strict";class bootstable{constructor(t,e){this.table=document.getElementById(t),this.headers=this._getTableHeaders(this.table),this.params=this._extend({columnsEd:null,$addButton:null,defaultValues:[],addButtonEdit:!0,buttons:null,onEdit:function(){},onBeforeDelete:function(){},onDelete:function(){},onAdd:function(){}},e),this.colEdicHtml=document.createElement("td"),this.colEdicHtml.setAttribute("name","buttons"),this.colEdicHtml.appendChild(this._buildDefaultButtons(this.params.buttons)),this.SetEditable(t)}SetEditable(t){const e=document.createElement("th");if(e.setAttribute("name","buttons"),this.params.$addButton){const d=document.createElement("button");d.className="btn btn-success float-end",d.id=this.params.$addButton,d.addEventListener("click",()=>{this.params.addButtonEdit?this.rowAddNewAndEdit(t,this.params.defaultValues):this.rowAddNew(t)});const r=document.createElement("i");r.className="fa fa-plus",d.appendChild(r),e.appendChild(d)}document.querySelectorAll(`#${t} thead tr`)[0].appendChild(e);const n=document.querySelectorAll(`#${t} tbody tr`);for(var o=0;o<n.length;o++){var a=document.createElement("td");a.setAttribute("name","buttons"),a.appendChild(this._buildDefaultButtons(this.params.buttons)),n[o].appendChild(a)}null!=this.params.columnsEd&&(this.colsEdi=this.params.columnsEd)}IterarCamposEdit(t,e){var n=0;for(const o of t){if(n++,"none"==o.style.display)return;if("buttons"==o.getAttribute("name"))return;if(!this.IsEditable(n-1))return;e(this,o,n-1)}}IsEditable(t){return null==this.colsEdi||!!this.colsEdi.includes(t)}ModoEdicion(t){return"editing"==t.id}SetButtonsNormal(t){var e;for(e of t.parentNode.childNodes)switch(e.id){case"bAcep":case"bCanc":e.style.display="none";break;case"bEdit":case"bElim":e.style.display="block"}t.parentNode.parentNode.parentNode.setAttribute("id","")}SetButtonsEdit(t){var e;for(e of t.parentNode.childNodes)switch(e.id){case"bAcep":case"bCanc":e.style.display="block";break;case"bEdit":case"bElim":e.style.display="none"}t.parentNode.parentNode.parentNode.setAttribute("id","editing")}butRowAcep(t){var e=t.parentNode.parentNode.parentNode,n=e.querySelectorAll("td");this.ModoEdicion(e)&&(this.IterarCamposEdit(n,function(t,e,n){var o=e.querySelector("input").value;e.innerHTML=o}),this.SetButtonsNormal(t),this.params.onEdit(e))}butRowCancel(t){var e=t.parentNode.parentNode.parentNode,n=e.querySelectorAll("td");this.ModoEdicion(e)&&(this.IterarCamposEdit(n,function(t,e,n){var o=e.querySelector("div").innerHTML;e.innerHTML=o}),this.SetButtonsNormal(t))}butRowEdit(t){var r,e=t.parentNode.parentNode.parentNode,n=e.querySelectorAll("td");this.ModoEdicion(e)||(r=!1,this.IterarCamposEdit(n,function(t,e,n){var o=e.innerHTML;e.innerHTML="";var a=document.createElement("div");a.style.display="none";var d=document.createTextNode(o);a.appendChild(d),e.appendChild(a);a=document.createElement("input");a.className="form-control form-control-sm",a.value=o,a.setAttribute("name",t.headers[n]),e.appendChild(a),r||(e.querySelectorAll("input")[0].focus(),r=!0)}),this.SetButtonsEdit(t))}butRowDelete(t){t=t.parentNode.parentNode.parentNode;this.params.onBeforeDelete(t),t.remove(),this.params.onDelete()}rowAddNew(t,e=[]){var n,o=document.getElementById(t),t=o.querySelectorAll("thead tr")[0].querySelectorAll("th"),a=0,d=document.createElement("tr");for(const r of t){if("buttons"==r.getAttribute("name"))d.appendChild(this.colEdicHtml);else{const s=document.createElement("td");a<e.length&&(n=document.createTextNode(e[a]),s.appendChild(n)),d.appendChild(s)}a++}o.querySelectorAll("tbody")[0].appendChild(d),this.params.onAdd()}rowAddNewAndEdit(t,e=[]){this.rowAddNew(t,e);t=document.getElementById(t).querySelectorAll("tbody")[0].lastChild;this.butRowEdit(t.querySelector("#bEdit"))}TableToCSV(t,e,n=!1,o=null){var a=[],d=document.getElementById(t),t=this._getTableHeaders(d);a.push(t);for(const l of d.querySelectorAll("tbody tr")){var r=l.querySelectorAll("td");a.push([]);for(const i of r)"buttons"!=i.getAttribute("name")&&a[a.length-1].push(i.innerHTML)}var s="";for(const c of a)s+=c.join(e)+"\n";return n&&o&&this._download(o,s,"application/csv"),s}TableToJson(t,e=!1,n=null){var o=[];const a=document.getElementById(t);var d=[];for(const s of a.querySelectorAll("thead tr th"))d.push(s.innerHTML);for(const l of a.querySelectorAll("tbody tr")){var r=0;o.push({});for(const i of l.querySelectorAll("td"))"buttons"!=i.getAttribute("name")&&(o[o.length-1][d[r]]=i.innerHTML,r++)}return e&&this._download(n,JSON.stringify(o),"application/json"),JSON.stringify(o)}_extend(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}_buildDefaultButtons(t={}){var e={bEdit:{className:"btn btn-sm btn-primary",icon:"fa fa-pencil",display:"block",onclick:t=>{var e=t.target;"I"==e.tagName&&(e=t.target.parentNode),this.butRowEdit(e)}},bElim:{className:"btn btn-sm btn-danger",icon:"fa fa-trash",display:"block",onclick:t=>{var e=t.target;"I"==e.tagName&&(e=t.target.parentNode),this.butRowDelete(e)}},bAcep:{className:"btn btn-sm btn-success",icon:"fa fa-check",display:"none",onclick:t=>{var e=t.target;"I"==e.tagName&&(e=t.target.parentNode),this.butRowAcep(e)}},bCanc:{className:"btn btn-sm btn-warning",icon:"fa fa-remove",display:"none",onclick:t=>{var e=t.target;"I"==e.tagName&&(e=t.target.parentNode),this.butRowCancel(e)}}};this.localbuttons=this._extend(e,t);const n=document.createElement("div");n.className="d-grid gap-2 d-md-flex justify-content-md-end";for(const o in this.localbuttons){const a=document.createElement("button");a.id=o,a.className=this.localbuttons[o].className,a.style.display=this.localbuttons[o].display,a.addEventListener("click",this.localbuttons[o].onclick);const d=document.createElement("i");d.className=this.localbuttons[o].icon,a.appendChild(d),n.appendChild(a)}return n}_download(t,e,n="text/plain"){var o=document.createElement("a");o.setAttribute("href",`data:${n};charset=utf-8,`+encodeURIComponent(e)),o.setAttribute("download",t),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}_getTableHeaders(t){var e=[];for(const n of t.querySelectorAll("thead tr th"))"buttons"!=n.getAttribute("name")&&e.push(n.innerHTML);return e}}